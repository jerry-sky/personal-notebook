<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-GB" xml:lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Jerry Sky" />
  <meta name="description" content="Gathered resources on improvements to my car." />
  <title>Car</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="/style.css" />
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Merriweather&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@500&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
</head>
<body>

<header id="title-block-header">
<h1 class="title">Car</h1>
<p class="author">
    <span>by </span>
    <span class="author">Jerry Sky</span>
</p>
</header>
<p id="document-description"><em>Gathered resources on improvements to
my car.</em></p>
<nav id="TOC">
<hr>
<ul>
<li><a href="#renault-samsung-control-panel"
id="toc-renault-samsung-control-panel"><span
class="toc-section-number">1.</span> Renault Samsung Control
Panel</a></li>
<li><a href="#resources-used" id="toc-resources-used"><span
class="toc-section-number">2.</span> Resources used:</a></li>
<li><a href="#interface" id="toc-interface"><span
class="toc-section-number">3.</span> Interface</a>
<ul>
<li><a href="#navigating-android-interface"
id="toc-navigating-android-interface"><span
class="toc-section-number">3.1.</span> Navigating Android
interface</a></li>
<li><a href="#media-buttons" id="toc-media-buttons"><span
class="toc-section-number">3.2.</span> Media buttons</a></li>
</ul></li>
</ul>
<hr>
</nav>
<h2 data-number="1." id="renault-samsung-control-panel"><span
class="header-section-number">1.</span> Renault Samsung Control
Panel</h2>
<p><img src="renault-control-panel.png"
alt="Renault Laguna III, Control Panel" /></p>
<p>This is the control panel used in Renault Laguna III cars produced
between 2013 and 2015. My car is from 2012. It is a Laguna III PH2, so
the first “lifting” version of the car. The second “lifting” version
brought R-Link which later could have been upgraded to enable Android
Auto, and because of that it had a different set of button labels. My
car has a TomTom Live navigation system, instead of R-Link, thus I don’t
have the option to use Android Auto by the book, and the button labels
were oriented towards this deprecated navigation system.</p>
<p>That’s why, I’m adapting the new control panel, to my
Bluetooth-capable ESP32 Arduino board, which I’m going to control my
Android phone with. This enables me to have a safer and more comfortable
interface than the phone touch screen which isn’t very accessible while
driving.</p>
<hr />
<h2 data-number="2." id="resources-used"><span
class="header-section-number">2.</span> Resources used:</h2>
<ul>
<li>Brian Lough’s:
<ul>
<li><a
href="https://www.youtube.com/watch?v=4sIkW7wogrE&amp;ab_channel=BrianLough">YT
Video tutorial — Bluetooth HID using just an ESP32</a></li>
<li><a
href="https://github.com/witnessmenow/arduino-switcheroonie">GitHub
repository containing the Arduino code — arudino-switcheroonie</a> —
I’ve repurposed Brian’s code for my use-case</li>
</ul></li>
<li><a
href="https://developer.android.com/reference/android/view/KeyEvent#KEYCODE_BOOKMARK">List
of Android keycodes</a></li>
<li>An Android phone connected via USB and <code>adb</code> and its
commands like <code>input keyevent</code></li>
<li><a href="https://github.com/T-vK/ESP32-BLE-Keyboard">ESP32 BLE
Keyboard Arduino library</a></li>
<li><a
href="https://sklep.msalamon.pl/produkt/esp32-devkit-esp-wroom-32-v2/">ESP32
hardware Arduino board</a></li>
<li><a
href="https://play.google.com/store/apps/details?id=com.arlosoft.macrodroid&amp;gl=PL">MacroDroid
— Android app for running macros</a></li>
<li><a
href="https://play.google.com/store/apps/details?id=io.github.sds100.keymapper&amp;gl=PL">Key
Mapper — Android app for remapping key events</a></li>
</ul>
<hr />
<h2 data-number="3." id="interface"><span
class="header-section-number">3.</span> Interface</h2>
<p><a
href="arduino/test_shortcut_keyboard/renault_control_panel_adapter.ino">The
Arduino adapter</a></p>
<p>I used a simple four by four keypad for testing purposes, the same
one that Brian Lough used when building his macro keypad.</p>
<p><img src="keypad.png" alt="Arduino keypad" /></p>
<h3 data-number="3.1." id="navigating-android-interface"><span
class="header-section-number">3.1.</span> Navigating Android
interface</h3>
<p>I’m using the arrow, and tab keys for basic navigation. The ESP32
board is sending keycodes to the phone, as it is recognized as a
standard Bluetooth keyboard. This is done via Arduino BLE keyboard
library.</p>
<p>e.g.:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;2&#39;</span><span class="op">:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    bleDevice<span class="op">.</span>press<span class="op">(</span>KEY_UP_ARROW<span class="op">);</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span><span class="op">;</span></span></code></pre></div>
<p>The joystick in the middle of the Renault control panel is used for
navigation. It can be rocked up, down, left, right (which is translated
to keyboard arrow keys) and it also be rotated clockwise and
anti-clockwise (which is translated to keyboard tab and shift+tab).</p>
<h3 data-number="3.2." id="media-buttons"><span
class="header-section-number">3.2.</span> Media buttons</h3>
<p>For other buttons like ‘Home’, ‘Map’, ‘Audio’, etc. the Arduino
controller sends macros that are then remapped via aforementioned app
(Key Mapper).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> pressMacroKey<span class="op">(</span><span class="dt">uint8_t</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    bleDevice<span class="op">.</span>press<span class="op">(</span>KEY_LEFT_CTRL<span class="op">);</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    bleDevice<span class="op">.</span>press<span class="op">(</span>KEY_LEFT_SHIFT<span class="op">);</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    bleDevice<span class="op">.</span>press<span class="op">(</span>KEY_LEFT_ALT<span class="op">);</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    bleDevice<span class="op">.</span>press<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">// […]</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;1&#39;</span><span class="op">:</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    pressMacroKey<span class="op">(</span>KEY_F1<span class="op">);</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span><span class="op">;</span></span></code></pre></div>
<p>Example mappings:</p>
<p><img src="keymapper.png" alt="Key Mapper example mappings" /></p>
<p>I’m using a different launcher for this “car mode” to separate
between normal phone use (when not in car) and car infotainment
system–like use.</p>
</body>
</html>
